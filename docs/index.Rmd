---
title: "index"
author: "Cyril"
date: "November 30, 2017"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

## Scatterplot
```{r scatterplot}


g <- ggplot(data =mpg, aes(x=displ, y= hwy))
g + geom_point()
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

#### I need color
```{r scatterplot in color}


f <- ggplot(data =mpg, aes(x=displ, y= hwy))
f + geom_point(aes(color = class))
```

#### I need B&W for journal

#### I need color
```{r scatterplot in b&w}


h <- ggplot(data =mpg, aes(x=displ, y= hwy))
h + geom_point(aes(shape = class))
```

### `Shape` now...

```{r shapesize}
ggplot(data =mpg, aes(x=cty, y= hwy, size = class)) +
  geom_jitter(color= "red") +
  geom_point(alpha = 0.5)
  

```

#### Let's play with labels

```{r labels}
ggplot(data = ,mpg, aes(x = displ, y = hwy)) +
  geom_point() +
  geom_smooth() +
  labs(title = "monkey business", x = "bananas", y = "fights") +
  theme_bw()
```

## Now with Mill Ck data

``` {r bring in data and massage}
wilkins <- read.csv("../data/Wilkins-2000-2016.csv")
mill <- read.csv(file = "../data/Mill_Ck_Pop.csv", )

## Add 2016 estimate to mill
mill <- rbind(mill, c(2016,92))

wilkins$return_year <- wilkins$Year+3

wilkins <- merge(wilkins, mill, by.y = "Year", by.x = "return_year", all.x = TRUE)

wilkins$Date <- as.POSIXct(wilkins$Date, format= "%m/%d/%Y")
wilkins$Julian <- format(wilkins$Date, format = "%j")

````

### Does flow during outmigration influence returning adults on Mill Ck?

``` {r returning adults vs flow}
flow_means <- aggregate(wilkins[wilkins$Julian>120,"Flow"], by=list(wilkins[wilkins$Julian>120, "Year"]), FUN=mean)
par(mar=c(5, 4, 4, 8) + 0.1)
barplot(height= unique(wilkins[wilkins$Julian>120,"Mill_Ck_Pop"]), axes = TRUE, col="gray", xlim=c(0.7,20), ylim=c(0,1450))
#axis(side = 1, labels = c(2000:2016)+3, at = c(2000:2016))
par(new = T)
plot(flow_means$Group.1, log(flow_means$x), ylab = "Returning adults", xlab= "Outmigration year", yaxt="n", col="red", pch=20)
#abline(a = 5000, b=0)
axis(side = 4)#, labels = c(2000:2016), at = c(2000:2016))
mtext("log of May Flow at Wilkins during outmigration", side=4, line=3, cex.lab=1, col="red")
```

## Let's do some data wrangling with Tidyr

```{r}
library(tidyverse)

gapminder <- read_csv("https://raw.githubusercontent.com/OHI-Science/data-science-training/master/data/gapminder.csv")
gapminder

## Useful functions to get to know your data
head(gapminder)
tail(gapminder)

str(gapminder)

## column headers
names(gapminder)

## data dimensions
dim(gapminder)
ncol(gapminder)
nrow(gapminder)

filter(gapminder, lifeExp < 29)

mean(filter(gapminder, country == "Sweden")$lifeExp)

## pipe operator `%>%` for sweden example

gapminder %>% 
  filter(country == "Sweden") %>%
 summarize(meanlifeExp= mean(lifeExp))

```

`read_csv` is from the `readr` package (part of the tidyverse). It is not `read.csv`, which is part of base R.
